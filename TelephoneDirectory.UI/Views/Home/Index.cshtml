
<div class="container">

    <div class="m-3">
        <div class="row shadow-sm p-3 mb-3 bg-secondary text-white rounded">
            <div class="col-md-9">
                <p class="font-weight-bold">TELEPHONE DIRECTORY</p>
            </div>
            <div class="col-md-3">
                <button type="button" class="btn btn-dark" data-toggle="modal" data-target="#addPersonModal">
                    Add Person
                </button>

            </div>
        </div>

        <div class="modal fade" id="addPersonModal">
            <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Add Person</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <div class="mb-3 row">
                            <label for="name" class="col-sm-4 col-form-label">Name</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="name">
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="surname" class="col-sm-4 col-form-label">Surname</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="surname">
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="companyName" class="col-sm-4 col-form-label">Company Name</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="companyName">
                            </div>
                        </div>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="AddUserBtn" data-dismiss="modal">Add</button>
                    </div>

                </div>
            </div>
        </div>

        <div class="table-responsive">


            <table id="personTable" class="table table-hover">
                <thead>
                    <tr>

                        <th>NAME</th>
                        <th>SURNAME</th>
                        <th>COMPANY NAME</th>
                        <th></th>
                        <th></th>
                        <th></th>

                    </tr>
                </thead>
                <tbody id="ptableBody">
                </tbody>
            </table>


        </div>

        <div class="modal fade" id="showContactModal">
            <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Add Contact Information</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">

                        <div class="table-responsive">


                            <table id="contactTable" class="table table-hover">
                                <thead>
                                    <tr>

                                        <th>PHONE NUMBER</th>
                                        <th>EMAIL</th>
                                        <th>ADDRESS</th>
                                    </tr>
                                </thead>
                                <tbody id="CtableBody">
                                </tbody>
                            </table>


                        </div>

                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" id="closeBtn" class="btn btn-primary" data-dismiss="modal">Close</button>
                    </div>

                </div>
            </div>
        </div>







        <div class="modal fade" id="addContactModal">
            <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Add Contact Information</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <div class="mb-3 row">
                            <label for="phoneNumber" class="col-sm-4 col-form-label">Phone Number</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="phoneNumber">
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="email" class="col-sm-4 col-form-label">Email</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="email">
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="address" class="col-sm-4 col-form-label">Address</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="address">
                            </div>
                        </div>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="AddContactBtn" data-dismiss="modal">Add</button>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
        crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"
        integrity="sha384-LtrjvnR4Twt/qOuYxE721u19sVFLVSA4hf/rRt6PrZTmiPltdZcI7q7PXQBYTKyf"
        crossorigin="anonymous"></script>


<script>

    $(document).ready(function () {

        $.ajax({
            type: "GET",
            url: "https://localhost:44394/userservice/getalluserscontacts",
            datatype: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                $("#personTable").DataTable({

                    data: data,
                    "columns": [
                        { data: "name", "autoWidth": true },
                        { data: "surname", "autoWidth": true },
                        { data: "companyName", "autoWidth": true },

                        {
                            "render": function (data, type, row) {
                                return "<a class='btn btn-primary' onclick=GetContact('" + row.userID + "')   data-toggle='modal' data-target='#showContactModal'>Contact Info</a>";
                            }
                        }
                        ,
                        {
                            "render": function (data, type, row) {
                                return "<a class='btn btn-primary' id='" + row.UserID + "'   data-toggle='modal' data-target='#addContactModal'>Add Contact Info</a>";
                            }
                        }
                        ,
                        {
                            "render": function (data, type, row) {
                                return "<a  class='btn btn-danger' onclick=DeletePerson('" + row.userID + "')>Delete Person</a > ";
                            }
                        }

                    ]

                });
            }
        });


        $("#AddContactBtn").click(function () {
            var PhoneNumber = $("#phoneNumber").val();
            var Email = $("#email").val();
            var Address = $("#address").val();
            var UserID = $(this).attr("id");
            debugger;
            $.ajax({
                type: "POST",
                url: "https://localhost:44394/userservice/addcontact",
                dataType: "JSON",
                contentType: "application/json; charset-utf-8",
                data: JSON.stringify({ 'PhoneNumber': PhoneNumber, 'Email': Email, 'Address': Address, 'UserID': UserID }),
                success: function (data) {
                    console.log("Contact Added");
                }
            });
        });


        $("#AddUserBtn").click(function () {
            var Name = $("#name").val();
            var Surname = $("#surname").val();
            var CompanyName = $("#companyName").val();

            $.ajax({
                type: "POST",
                url: "https://localhost:44394/userservice/adduser",
                dataType: "JSON",
                contentType: "application/json; charset-utf-8",
                data: JSON.stringify({ 'Name': Name, 'Surname': Surname, 'CompanyName': CompanyName }),
                success: function (data) {
                    
                    console.log("Person Added");
                    window.location.reload();
                }
            });
        });







        $("#closeBtn").click(function () {
            window.location.reload();
        });




    });


    function GetContact(userId) {
        $.ajax({
            type: "POST",
            url: "https://localhost:44394/userservice/getcontact",
            datatype: "json",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ 'UserID': userId }),
            success: function (data) {
                
                if (data != null) {
                    $("#contactTable").DataTable({

                        data: data,

                        "columns": [
                            { data: "email", "autoWidth": true },
                            { data: "address", "autoWidth": true },
                            { data: "phoneNumber", "autoWidth": true },

                        ]

                    });
                }
                
            }
        });

    }

    function DeletePerson(userId) {
        $.ajax({
            type: "POST",
            url: "https://localhost:44394/userservice/deleteuser",
            datatype: "json",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ 'UserID': userId }),
            success: function (data) {
                window.location.reload();
                console.log("ready!");
            }
        });
    }


 



</script>
